# Common Language Runtime (CLR) ç­†è¨˜

## ðŸŒ CLR æ˜¯ä»€éº¼ï¼Ÿ

**Common Language Runtime (CLR)** æ˜¯ .NET çš„æ ¸å¿ƒåŸ·è¡Œå¼•æ“Žï¼Œè² è²¬ç®¡ç† .NET æ‡‰ç”¨ç¨‹å¼çš„åŸ·è¡Œã€‚  
å®ƒæ˜¯ .NET Framework å’Œ .NET Core / .NET 5+ çš„é—œéµçµ„æˆéƒ¨åˆ†ï¼Œæä¾›å„ç¨®åŸ·è¡ŒéšŽæ®µæ”¯æ´åŠŸèƒ½ã€‚

---

## ðŸ”§ CLR çš„åŠŸèƒ½

| åŠŸèƒ½ | èªªæ˜Ž |
|------|------|
| **è¨˜æ†¶é«”ç®¡ç†** | è‡ªå‹•é€²è¡Œåžƒåœ¾å›žæ”¶ï¼ˆGarbage Collectionï¼‰ï¼Œé‡‹æ”¾ä¸å†ä½¿ç”¨çš„ç‰©ä»¶ã€‚ |
| **JIT ç·¨è­¯** | å°‡ C# ç·¨è­¯å¾Œçš„ ILï¼ˆIntermediate Languageï¼‰è½‰æ›ç‚ºæ©Ÿå™¨ç¢¼åŸ·è¡Œã€‚ |
| **å®‰å…¨æ€§ç®¡ç†** | ç®¡æŽ§æ‡‰ç”¨ç¨‹å¼çš„åŸ·è¡Œæ¬Šé™ï¼ˆå¦‚ Code Access Securityï¼‰ã€‚ |
| **ä¾‹å¤–è™•ç†** | æä¾›è·¨èªžè¨€ä¸€è‡´çš„ä¾‹å¤–è™•ç†æ©Ÿåˆ¶ã€‚ |
| **é¡žåž‹å®‰å…¨** | ç¢ºä¿ç¨‹å¼åŸ·è¡Œæ™‚åž‹åˆ¥æ­£ç¢ºï¼Œé˜²æ­¢è¨˜æ†¶é«”éŒ¯èª¤ã€‚ |
| **åŸ·è¡Œç·’èˆ‡åŒæ­¥** | ç®¡ç†å¤šåŸ·è¡Œç·’ã€åŒæ­¥èˆ‡éŽ–å®šæŽ§åˆ¶ã€‚ |

---

## âš™ï¸ CLR åŸ·è¡Œæµç¨‹

1. ç·¨è­¯ C# ç¨‹å¼ç¢¼æˆç‚º ILï¼ˆä¸­ä»‹èªžè¨€ï¼‰ã€‚
2. IL éš¨çµ„ä»¶ï¼ˆ.dll æˆ– .exeï¼‰è¢«è¼‰å…¥ã€‚
3. CLR ä½¿ç”¨ Just-In-Time ç·¨è­¯å™¨ï¼ˆJITï¼‰å°‡ IL è½‰æˆæ©Ÿå™¨ç¢¼ã€‚
4. åŸ·è¡Œæ©Ÿå™¨ç¢¼ï¼ŒCLR ç®¡ç†å…¶ç”Ÿå‘½é€±æœŸèˆ‡è¨˜æ†¶é«”ã€‚

---

## ðŸ’¡ CLR vs JVM

| åŠŸèƒ½é¢ | CLR (.NET) | JVM (Java) |
|--------|------------|------------|
| æ”¯æ´èªžè¨€ | å¤šç¨®ï¼ˆC#, F#, VB.NET ç­‰ï¼‰ | ä¸»è¦ç‚º Java |
| å¹³å° | Windows / Linux / macOS (.NET Core/5+) | è·¨å¹³å° |
| ç·¨è­¯æ¨¡å¼ | JIT / AOT (.NET 6+) | JIT / AOT |

---

## ðŸ“Œ å°çµ

> CLR æ˜¯ .NET æ‡‰ç”¨ç¨‹å¼çš„åŸ·è¡ŒåŸºç¤Žï¼Œè² è²¬è¨˜æ†¶é«”ã€ç·¨è­¯ã€å®‰å…¨æ€§ã€ä¾‹å¤–èˆ‡åŸ·è¡Œç·’ç­‰é—œéµåŠŸèƒ½ï¼Œæ˜¯ä½ ç†è§£ .NET å¹³å°é‹ä½œçš„æ ¸å¿ƒã€‚

---

## ðŸ“š å»¶ä¼¸é–±è®€

- [.NET å®˜æ–¹æ–‡ä»¶ - What is CLR](https://learn.microsoft.com/en-us/dotnet/standard/clr)
- [JIT Compiler Explained](https://learn.microsoft.com/en-us/dotnet/standard/clr/jit-compiler)




# N+1 å•é¡Œï¼ˆN+1 Query Problemï¼‰

## ðŸ§ ä»€éº¼æ˜¯ N+1 å•é¡Œï¼Ÿ

ç•¶ä½ æŸ¥è©¢ä¸€çµ„è³‡æ–™ï¼ˆä¾‹å¦‚ N ç­†è¨‚å–®ï¼‰ï¼Œç„¶å¾Œå°æ¯ç­†è³‡æ–™å†å€‹åˆ¥æŸ¥è©¢å…¶é—œè¯è³‡æ–™ï¼ˆä¾‹å¦‚æ¯ç­†è¨‚å–®çš„é …ç›®ï¼‰ï¼Œæœƒå°Žè‡´ **1 æ¬¡ä¸»æŸ¥è©¢ + N æ¬¡é—œè¯æŸ¥è©¢**ï¼Œç¸½å…± N+1 æ¬¡æŸ¥è©¢ï¼Œé€²è€Œé€ æˆæ•ˆèƒ½å•é¡Œã€‚

---

## ðŸ§¾ ç¯„ä¾‹èªªæ˜Žï¼ˆä»¥ Entity Framework ç‚ºä¾‹ï¼‰

```csharp
// æŸ¥è©¢æ‰€æœ‰è¨‚å–®
var orders = context.Orders.ToList(); // é€™æ˜¯ç¬¬ 1 æ¬¡æŸ¥è©¢

// å°æ¯ç­†è¨‚å–®å­˜å– Items
foreach (var order in orders)
{
    var items = order.Items; // æ¯æ¬¡éƒ½è§¸ç™¼ 1 æ¬¡æŸ¥è©¢ï¼Œå…± N æ¬¡
}
```

##è§£æ³•ï¼šä½¿ç”¨ Eager Loading é¿å… N+1 å•é¡Œ
```csharp
// ä½¿ç”¨ Include ä¸€æ¬¡æŸ¥å›žæ‰€æœ‰è¨‚å–®èˆ‡å…¶é …ç›®
var orders = context.Orders
                    .Include(o => o.Items)
                    .ToList(); // åƒ…åŸ·è¡Œ 1 æ¬¡æŸ¥è©¢
```